# Elevation input
-----
This directory contains a script to derive a gridded dataset of elevation for
an existing grid.

## Input
You will need a source dataset providing gridded elevation data. 
For example, NOAA National Centers for Environmental Information (NCEI) provides
the ETOPO1 Global Relief Model at 1 arc-minute spatial resolution:
https://www.ngdc.noaa.gov/mgg/global/global.html

Alternatively, IIASA provides "Global Terrain Slope and Aspect Data" as
supplementary data to its Harmonized World Soil Database (HWSD):
https://webarchive.iiasa.ac.at/Research/LUC/External-World-soil-database/HTML/global-terrain-slope-download.html?sb=7

Other gridded elevation data may be used as well as long as it is in a
single-file raster format.

You will also need an LPJmL grid file as generated by the scripts in `../gadm`

## Software requirements
You will need the Generic Mapping Tools (GMT) to resample ETOPO1 data. GMT is
available for Windows, MacOS and Linux from
https://www.generic-mapping-tools.org/

You also need `R` and the R package `raster` to run elevation_input.R

## Files included in this directory
  - download_and_resample_etopo.sh: shell script which downloads global ETOPO1
    data and resamples it to the target resolution
  - elevation_input.R: script to derive elevation input for a specified grid
    from elevation source dataset
  - README.md: this file
  - r_modules.sh: bash script that loads all required modules to run R script
    on the PIK cluster

## How to use
  - Shell script download_and_resample_etopo.sh will download ETOPO1 global
    data from NOAA National Centers for Environmental Information and resample
    it to the target resolution.
  - Script elevation_input.R will extract elevation for all cells included in
    `gridname` and write an elevation file in either LPJmL input format or as a
    CSV table. Elevation source data must be in a format supported by the
    `raster` package in R and must be in the correct resolution already. This
    can be created by `download_and_resample_etopo.sh` or elevation data from
    any other source.

## Minimum setup in download_and_resample_etopo.sh
  - Set `xres` and `yres` to target resolutiom

### Additional settings in download_and_resample_etopo.sh
 - `etopo1_src_url`: remote address of ETOPO1 source data
 - `etopo_src_local`: local filename to use for ETOPO1 source data
 - `download_etopo1`: either TRUE or FALSE; scripts tries to download source
   data only if set to TRUE; set to FALSE to resample source data again without
   downloading remote files
 - `resample_operation`: either AGGREGATE or DISAGGREGATE. Use "AGGREGATE" if
   your target resolution is coarser than the source resolution
 - `aggregation_function`: use either "blockmean" or "blockmedian" to aggregate
   data. Default: blockmedian
 - `mask_ocean`: ETOPO1 data includes ocean floors. Set `mask_ocean` to TRUE
   (default) to prevent coastal cells to be averaged across land and ocean which
   leads to elevation below sea level.
 - `etopo1_tgt_name`: filename of resampled elevation data 
   (`aggregation_function` is added to this filename later in the script)
 - See additional parameters used by GMT for resampling
 
## Minimum setup in elevation_input.R
  - Set `elevationdir` to working directory containing elevation source data.
  - Set `gridname` and `gridformat` to point to a grid file. This can be a grid
    input file in LPJmL input format or a CSV table.
  - If `gridname` points to a CSV file, set `lpj_res` to the spatial resolution
    of the provided grid list.
  - Set `elevation_source_name` to point to the elevation source data.
  - Set `elevationformat` to either LPJmL input format or CSV. This affects the
    elevation file created by this script.

### Additional settings in elevation_input.r
  - `bintype`: Header version to be used in LPJmL input format. Either 2 or 3. 
    Only version 3 supports longitude and latitude grid sizes to differ
  - `elevation_headername`: Header name to be included in LPJmL input format. 
    Must be the same as used in the LPJmL model source code.
  - If necessary, update path to `lpjml_format_helper_functions.R` which is
    usually located in the base directory of the toolbox.
