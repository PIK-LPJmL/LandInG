# Lakes and rivers

The directory contains scripts to derive cell fractions covered by different
types of water bodies.

## Input
The Global Lakes and Wetlands Database (GLWD) is used as source dataset.
You may either use GLWD Level 3 raster data or polygon data of GWLD level 1
and 2.

Processing GLWD Level 3 data is generally faster, but supports only target
resolutions that are an integer multiple of the source resolution.
Using GLWD level 1 and 2 polygon data provides more flexibility in terms of the
target resolution.

Download either Level 3 data or Level 1 and 2 data from
https://www.worldwildlife.org/pages/global-lakes-and-wetlands-database and unzip
in working directory.

You will need a grid input file in LPJmL format for both approaches.
This file can be generated by the scripts in `../gadm`

## Software requirements
- `R`
- R packages `lwgeom`, `raster`, `rgdal`, `sf`; to use MPI backend for
  parallelization: `doMPI`, `Rmpi`; or use `doParallel`, `parallel` to run on
  multiple CPUs of a local machine.

## Files included in this directory
  - lakes_rivers_fraction.R: Script to derive cell fractions of cells in grid
    input file covered by different types of water bodies distinguished by GLWD
    level 3
  - lakes_rivers_fraction_SLURM.sh: Example batch script to submit
    lakes_rivers_fraction.R as a job on the PIK high-performance cluster
  - lakes_rivers_polygonbased.R: Script to derive cell fractions of cells in
    grid input file covered by different types of water bodies based on polygon
    data
  - lakes_rivers_polygonbased_SLURM.sh:Example batch script to submit
    lakes_rivers_polygonbased.R as a job on the PIK high-performance cluster
  - README.md: This file
  - r_modules.sh: Shell script to load necessary modules to run R script on
    PIK high-performance cluster

## Setup for lakes_rivers_fraction.R
  - `glwd_dir`: Directory where outputs will be saved
  - `gridname`: Set path to LPJmL grid input file
  - `glwd3_name`: Set path to GLWD level 3 raster file (usually unzipped as
    `glwd_3/hdr.adf`)
  - `glwd3_classes`: Set up which GLWD types of water bodies to extract
    (default: lakes, rivers)
  - `version_string`: Optional version string added to filenames of files
    created by this script

### Additional settings in lakes_rivers_fraction.R
  - `output_format`: Select either one of the native LPJmL input formats
    ("BIN", "RAW") or a raster format supported by the raster package (e.g.
    NetCDF or ASCII grid) for files created by this script
  - `bintype`: Version of `BIN` format used (default: 3)
  - `headername`: Header name used in file header if `BIN` format is used.
    This must match the header name defined in LPJmL source code (default:
    "LPJLAKE")

## Setup for lakes_rivers_polygonbased.R
  - `glwd_dir`: Directory where outputs will be saved
  - `gridname`: Set path to LPJmL grid input file
  - `glwd1_name`: Set path to GLWD level 1 polygon shapefile
  - `glwd2_name`: Set path to GLWD level 2 polygon shapefile
  - `glwd_classes`: Set up which GLWD types of water bodies to extract
    (default: lakes, rivers)
  - `version_string`: Optional version string added to filenames of files
    created by this script

### Additional settings in lakes_rivers_polygonbased.R
  - `output_format`: Select either one of the native LPJmL input formats
    ("BIN", "RAW") or a raster format supported by the raster package (e.g.
    NetCDF or ASCII grid) for files created by this script
  - `bintype`: Version of `BIN` format used (default: 3)
  - `headername`: Header name used in file header if `BIN` format is used.
    This must match the header name defined in LPJmL source code (default:
    "LPJLAKE")
